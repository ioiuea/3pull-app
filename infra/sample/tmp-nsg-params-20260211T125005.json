{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "nsgs": {
      "value": [
        {
          "subnetName": "usernode",
          "securityRules": [
            {
              "name": "Allow-HTTPS-From-K8SAPIServer",
              "properties": {
                "sourceAddressPrefixes": [
                  "10.189.70.0/24",
                  "10.189.72.128/26"
                ],
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.70.0/24",
                "destinationPortRanges": [
                  "443",
                  "4443"
                ],
                "protocol": "TCP",
                "access": "Allow",
                "priority": 200,
                "direction": "Inbound"
              }
            },
            {
              "name": "Allow-HTTP-From-AgwSubnet",
              "properties": {
                "sourceAddressPrefix": "10.189.71.0/25",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.70.0/24",
                "destinationPortRanges": [
                  "8080",
                  "3000",
                  "3080"
                ],
                "protocol": "TCP",
                "access": "Allow",
                "priority": 201,
                "direction": "Inbound"
              }
            },
            {
              "name": "Allow-Any-From-MaintVmSubnet",
              "properties": {
                "sourceAddressPrefix": "10.189.72.192/29",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.70.0/24",
                "destinationPortRange": "*",
                "protocol": "*",
                "access": "Allow",
                "priority": 202,
                "direction": "Inbound"
              }
            },
            {
              "name": "Allow-8080-From-ActionGroup",
              "properties": {
                "sourceAddressPrefix": "ActionGroup",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.70.0/24",
                "destinationPortRange": "8080",
                "protocol": "*",
                "access": "Allow",
                "priority": 203,
                "direction": "Inbound"
              }
            },
            {
              "name": "DenyAll",
              "properties": {
                "sourceAddressPrefix": "*",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.70.0/24",
                "destinationPortRange": "*",
                "protocol": "*",
                "access": "Deny",
                "priority": 4096,
                "direction": "Inbound"
              }
            }
          ]
        },
        {
          "subnetName": "pep",
          "securityRules": [
            {
              "name": "Allow-Any-From-AksSubnet",
              "properties": {
                "sourceAddressPrefix": "10.189.70.0/24",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.72.64/26",
                "destinationPortRange": "*",
                "protocol": "*",
                "access": "Allow",
                "priority": 200,
                "direction": "Inbound"
              }
            },
            {
              "name": "Allow-Any-From-MaintVmSubnet",
              "properties": {
                "sourceAddressPrefix": "10.189.72.192/29",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.72.64/26",
                "destinationPortRange": "*",
                "protocol": "*",
                "access": "Allow",
                "priority": 201,
                "direction": "Inbound"
              }
            },
            {
              "name": "DenyAll",
              "properties": {
                "sourceAddressPrefix": "*",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.72.64/26",
                "destinationPortRange": "*",
                "protocol": "*",
                "access": "Deny",
                "priority": 4096,
                "direction": "Inbound"
              }
            }
          ]
        },
        {
          "subnetName": "agentnode",
          "securityRules": [
            {
              "name": "Allow-HTTPS-From-K8SAPIServer",
              "properties": {
                "sourceAddressPrefix": "10.189.72.128/26",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.72.128/26",
                "destinationPortRanges": [
                  "443",
                  "4443"
                ],
                "protocol": "TCP",
                "access": "Allow",
                "priority": 200,
                "direction": "Inbound"
              }
            },
            {
              "name": "Allow-HTTP-From-AgwSubnet",
              "properties": {
                "sourceAddressPrefix": "10.189.71.0/25",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.72.128/26",
                "destinationPortRanges": [
                  "8080",
                  "3000",
                  "3080"
                ],
                "protocol": "TCP",
                "access": "Allow",
                "priority": 201,
                "direction": "Inbound"
              }
            },
            {
              "name": "Allow-Any-From-MaintVmSubnet",
              "properties": {
                "sourceAddressPrefix": "10.189.72.192/29",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.72.128/26",
                "destinationPortRange": "*",
                "protocol": "*",
                "access": "Allow",
                "priority": 202,
                "direction": "Inbound"
              }
            },
            {
              "name": "Allow-8080-From-ActionGroup",
              "properties": {
                "sourceAddressPrefix": "ActionGroup",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.72.128/26",
                "destinationPortRange": "8080",
                "protocol": "*",
                "access": "Allow",
                "priority": 203,
                "direction": "Inbound"
              }
            },
            {
              "name": "DenyAll",
              "properties": {
                "sourceAddressPrefix": "*",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.72.128/26",
                "destinationPortRange": "*",
                "protocol": "*",
                "access": "Deny",
                "priority": 4096,
                "direction": "Inbound"
              }
            }
          ]
        },
        {
          "subnetName": "maint",
          "securityRules": [
            {
              "name": "Allow-SSH-From-BastionServer",
              "properties": {
                "sourceAddressPrefix": "10.189.74.1",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.72.192/29",
                "destinationPortRange": "22",
                "protocol": "TCP",
                "access": "Allow",
                "priority": 200,
                "direction": "Inbound"
              }
            },
            {
              "name": "DenyAll",
              "properties": {
                "sourceAddressPrefix": "*",
                "sourcePortRange": "*",
                "destinationAddressPrefix": "10.189.72.192/29",
                "destinationPortRange": "*",
                "protocol": "*",
                "access": "Deny",
                "priority": 4096,
                "direction": "Inbound"
              }
            }
          ]
        }
      ]
    }
  }
}
