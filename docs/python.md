# Python Coding Rules

このドキュメントは、本リポジトリで Python を実装・修正する際のルールを定義します。
特に `infra/scripts/*.py` のような運用スクリプトは、可読性と保守性を優先します。

## 基本方針

- PEP 8 を標準ルールとして扱います。
- 処理の意図が第三者に伝わるように、関数・主要ブロックに説明を付けます。
- ロジックを変えないリファクタでも、可読性改善は積極的に行います。

## PEP 8 必須ルール

- インデントはスペース 4 つ。タブは使用しない。
- 1 行の長さは原則 79 文字以内（コメント/Docstring は 72 文字程度を目安）。
- import はファイル先頭にまとめ、標準ライブラリ -> サードパーティ -> ローカルの順で整理する。
- 代入や演算子の前後には適切な空白を入れる。
- 末尾空白を残さない。
- 1 ファイル内の関数/クラスの間には空行を入れる。

## 命名規則

- 関数・変数: `snake_case`
- 定数: `UPPER_CASE`
- クラス: `CapWords`
- ブール値は意味がわかる名前にする（例: `enable_ddos_protection`）。

## コメントと Docstring

- ファイル先頭に「何をするスクリプトか」を説明するモジュール Docstring を記載する。
- 関数には入力/出力や目的がわかる Docstring を記載する。
- コメントは「何をしているか」だけでなく「なぜ必要か」を優先して書く。
- コメントは実装と矛盾しないよう、コード変更時に必ず更新する。

## 例外処理

- 入力検証エラーは、利用者が修正できる具体的なメッセージで返す。
- `raise SystemExit(...)` を使う場合は、停止理由を明確に記述する。
- 想定外エラーを握りつぶさない。

## 型とデータ構造

- 可能な範囲で型ヒントを付与する。
- JSON を扱う処理は、想定キーの存在チェックと型チェックを行う。
- `dict`/`list` を返す場合は、構造が追えるようにキー名を明確化する。

## 変更時のチェック

- 変更後は最低限 `python3 -m py_compile infra/scripts/*.py` で構文確認を行う。
- 実行フローに影響する変更は、`main.sh` からの呼び出し引数・環境変数との整合を確認する。

